<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VectorizeIt - Vectorización Básica</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        #dropzone { border: 2px dashed #ccc; padding: 20px; text-align: center; }
        #preview { margin-top: 20px; display: flex; justify-content: space-between; }
        .image-container { width: 45%; }
        .image-label { text-align: center; margin-top: 5px; }
        #log { margin-top: 20px; border: 1px solid #ccc; padding: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>VectorizeIt - Vectorización Básica</h1>

        <div id="upload-container">
            <div id="dropzone">
                Arrastra y suelta una imagen aquí, o haz clic para seleccionar un archivo
            </div>
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
        </div>

        <div id="preview" style="display: none;">
            <div class="image-container">
                <img id="originalImage" alt="Imagen Original">
                <div class="image-label">Imagen Original</div>
            </div>
            <div class="image-container">
                <svg id="vectorImage"></svg>
                <div class="image-label">Imagen Vectorizada</div>
            </div>
        </div>

        <div id="log"></div>
    </div>

    <script>
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');
        const originalImage = document.getElementById('originalImage');
        const vectorImage = document.getElementById('vectorImage');
        const logDiv = document.getElementById('log');

        function log(message) {
            console.log(message);
            logDiv.innerHTML += message + '<br>';
        }

        dropzone.addEventListener('click', () => fileInput.click());
        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });
        dropzone.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            log('Archivo soltado');
            const file = e.dataTransfer.files[0];
            processFile(file);
        }

        function handleFileSelect(e) {
            log('Archivo seleccionado');
            const file = e.target.files[0];
            processFile(file);
        }

        function processFile(file) {
            if (!file) {
                log('No se seleccionó ningún archivo');
                return;
            }
            log(`Procesando archivo: ${file.name}`);
            
            const reader = new FileReader();
            reader.onload = (event) => {
                log('Archivo leído correctamente');
                originalImage.src = event.target.result;
                originalImage.onload = () => {
                    preview.style.display = 'flex';
                    log('Imagen mostrada en preview');
                    vectorizeImage();
                };
            };
            reader.onerror = (error) => {
                log(`Error al leer el archivo: ${error}`);
            };
            reader.readAsDataURL(file);
        }

        function vectorizeImage() {
            log('Iniciando vectorización');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = originalImage.width;
            canvas.height = originalImage.height;
            ctx.drawImage(originalImage, 0, 0);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const edges = detectEdges(imageData);
            const paths = tracePaths(edges);

            vectorImage.setAttribute('width', canvas.width);
            vectorImage.setAttribute('height', canvas.height);
            vectorImage.setAttribute('viewBox', `0 0 ${canvas.width} ${canvas.height}`);
            vectorImage.innerHTML = paths.map(path => `<path d="${path}" fill="none" stroke="black" />`).join('');

            log('Vectorización completada');
        }

        function detectEdges(imageData) {
            const edges = new Uint8Array(imageData.width * imageData.height);
            const threshold = 30;

            for (let y = 1; y < imageData.height - 1; y++) {
                for (let x = 1; x < imageData.width - 1; x++) {
                    const idx = (y * imageData.width + x) * 4;
                    const neighbors = [
                        imageData.data[idx - 4], imageData.data[idx + 4],
                        imageData.data[idx - imageData.width * 4], imageData.data[idx + imageData.width * 4]
                    ];
                    const diff = Math.max(...neighbors.map(n => Math.abs(n - imageData.data[idx])));
                    edges[y * imageData.width + x] = diff > threshold ? 255 : 0;
                }
            }

            return edges;
        }

        function tracePaths(edges) {
            const paths = [];
            const width = Math.sqrt(edges.length);
            const visited = new Uint8Array(edges.length);

            for (let y = 0; y < width; y++) {
                for (let x = 0; x < width; x++) {
                    if (edges[y * width + x] && !visited[y * width + x]) {
                        paths.push(tracePath(x, y, edges, visited, width));
                    }
                }
            }

            return paths;
        }

        function tracePath(startX, startY, edges, visited, width) {
            let path = `M${startX},${startY}`;
            let x = startX, y = startY;

            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];

            while (true) {
                visited[y * width + x] = 1;
                let found = false;

                for (const [dx, dy] of directions) {
                    const nx = x + dx, ny = y + dy;
                    if (nx >= 0 && nx < width && ny >= 0 && ny < width &&
                        edges[ny * width + nx] && !visited[ny * width + nx]) {
                        path += `L${nx},${ny}`;
                        x = nx;
                        y = ny;
                        found = true;
                        break;
                    }
                }

                if (!found) break;
            }

            return path;
        }
    </script>
</body>
</html>
